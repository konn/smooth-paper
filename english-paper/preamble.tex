\usepackage[final]{listings}
\usepackage[prologue,gray]{xcolor}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{braket}
\usepackage{tikz}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{minted}
\ifLuaTeX
\usepackage{fontspec}
\setmonofont[StylisticSet=3]{inconsolata}
\else
\usepackage{inconsolata}
\fi
\usepackage[backend=biber,style=numeric]{biblatex}
\usepackage{stmaryrd}
\usetikzlibrary{matrix,decorations,arrows,calc,trees}
\addbibresource{../references.bib}
\usepackage{tcolorbox}
\tcbuselibrary{listings,xparse}
\usepackage[draft]{fixme}
\usepackage{enumitem}
\newcommand{\coloneq}{\mathrel{:=}}
\makeatletter

\newtheorem{algorithm}{Algorithm}
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

% \setcopyright{acmcopyright}
% \copyrightyear{2021}
% \acmYear{2021}
% \acmDOI{10.1145/1122445.1122456}

% \acmConference[Woodstock '18]{Woodstock '18: ACM Symposium on Neural
%  Gaze Detection}{June 03--05, 2018}{Woodstock, NY}
% \acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
%  June 03--05, 2018, Woodstock, NY}
% \acmPrice{15.00}
% \acmISBN{978-1-4503-XXXX-X/18/06}

%%\acmSubmissionID{123-A56-BU3}

\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\rem}[2]{{\overline{#1}}^{#2}}
\newcommand{\X}{\boldsymbol{X}}
\newcommand{\Y}{\boldsymbol{Y}}
\newcommand{\Rseries}{\mathord{\R\llbracket\X\rrbracket}}
\DeclareMathOperator{\NonVan}{NV}
\DeclareMathOperator{\RF}{RF}
\newcommand{\Tower}{\mathord{\mathrm{Tower}}}
\newcommand{\smoothto}{\xrightarrow{C^\infty}}

% Syntax
\definecolor{ltblue}{rgb}{0,0.4,0.4}
\definecolor{dkblue}{rgb}{0,0.1,0.6}
\definecolor{dkgreen}{rgb}{0,0.35,0}
\definecolor{dkviolet}{rgb}{0.3,0,0.5}
\definecolor{dkred}{rgb}{0.5,0,0}
\definecolor{comment}{HTML}{444444}
\definecolor{keywd}{HTML}{8D00ED}
\definecolor{types}{HTML}{1F7B2F}
\definecolor{str}{HTML}{4070a0}
\definecolor{code-background}{gray}{0.8}
\definecolor{pragma}{HTML}{372A78}
\definecolor{num}{HTML}{40a070}
\definecolor{symb}{HTML}{000000}
\newcommand\symbmath[1]{{\ensuremath{\color{symb}#1}}}
\newcommand\typemath[1]{{\ensuremath{\ul{#1}}}}
\newcommand{\moncompose}{\mathbin{>\mkern-6mu=\mkern-6mu>}}
\newcommand\colmath[2]{{\ensuremath{\color{#1}#2}}}
\def\ul#1{{\underline{\bfseries #1}}}
\newcommand{\divs}{\mathrel{\mid}}
\newcommand{\CartSp}{\mathord{\mathrm{CartSp}}}
\newcommand{\RAlg}{\mathord{\R{\text{-}}\mathrm{Alg}}}
\newcommand{\Sets}{\mathord{\mathrm{Sets}}}

\newminted[code]{haskell}{%
mathescape,linenos,numbersep=5pt,frame=lines,framesep=2mm,%
}
\lstset{basicstyle=\ttfamily,numberstyle=\ttfamily\tiny}
\lstdefinelanguage{algorithm}{
  morecomment=[l][\slshape\color{comment}]{//},
  morecomment=[n][\bfseries\itshape]{/*}{*/},
  morestring=[b]\",
  stringstyle={\slshape},
  keywords={Pick,For,Done,End,in,with,Let,While,Loop,Do,Then,Else,Until,Unless,Return,INPUT,OUTPUT,If},
  numbers=left,
  escapechar=\@,
  keywordstyle={\ul},
  morekeywords=[2]{*,+,/,-,.,\%,!,?,=,<,>,$},
  keywordstyle=[2]{\ttfamily\bfseries},
  morekeywords=[3]{Convol,WeilTest,LiftWeil,LiftSeriesPoly,TowerAD},
  keywordstyle=[3]{\rmfamily\upshape\scshape},
  emphstyle={[2]\itshape},
  literate=
    {/=}{{\symbmath{\neq}}}2
    {forall}{{\ensuremath{\pmb{\forall}}}}1
    {*}{{\symbmath{\times}}}1
    {I}{{\symbmath{I}}}1
    {+}{{\symbmath{+}}}1
    {>}{{\symbmath{>}}}2
    {...}{{\symbmath{\ldots}}}2
    {<}{{\symbmath{<}}}2
    {alpha}{{\symbmath{\alpha}}}1
    {beta}{{\symbmath{\beta}}}1
    {->}{{\symbmath{\rightarrow}}}2 {>=}{{\symbmath{\geq}}}2 {<-}{{\symbmath{\leftarrow}}}2
    {g_i}{{\symbmath{g_i}}}2
    {f_i}{{\symbmath{f_i}}}2
    {===}{{\symbmath{\equiv}}}2
    {==>}{{\symbmath{\Longrightarrow}}}{3}
    {\\}{{\symbmath{\lambda}}}1
    {<=}{{\symbmath{\leq}}}1 {=>}{{\symbmath{\Rightarrow}}}2
}
\lstnewenvironment{alg}[1][frame=leftline]{\lstset{language=algorithm}}{}

\VerbatimFootnotes
\DeclareTotalTCBox{\hask}{v}{%
tcbox raise base,box align=base,verbatim,colback=lightgray,colframe=gray%
}{\mintinline[fontsize=\tiny]{haskell}{#1}}
\let\haskinline=\hask

\newminted[repl]{haskell}{%
mathescape,numbersep=5pt,frame=lines,framesep=2mm,%
}

\DeclareTotalTCBox{\hask}{v}{box align=base,verbatim,colback=lightgray,colframe=gray}{\lstinline[language=haskell]{#1}}
