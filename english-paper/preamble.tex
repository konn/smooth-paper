\usepackage[final]{listings}
\usepackage{cleveref}
\usepackage{braket}
\usepackage{tikz}
\usetikzlibrary{matrix,decorations,arrows,calc,trees}
\usepackage[draft]{fixme}
\usepackage{enumitem}

\makeatletter
\newtheoremstyle{acmplainbreak}%
  {.5\baselineskip\@plus.2\baselineskip%
    \@minus.2\baselineskip}% space above
  {.5\baselineskip\@plus.2\baselineskip%
    \@minus.2\baselineskip}% space below
  {\@acmplainbodyfont}% body font
  {\@acmplainindent}% indent amount
  {\@acmplainheadfont}% head font
  {.}% punctuation after head
  {.5em}% spacing after head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ {\@acmplainnotefont(#3)}}}
\makeatother

\theoremstyle{acmplainbreak}
\newtheorem{algorithm}{Algorithm}
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

% \setcopyright{acmcopyright}
\copyrightyear{2021}
\acmYear{2021}
% \acmDOI{10.1145/1122445.1122456}

% \acmConference[Woodstock '18]{Woodstock '18: ACM Symposium on Neural
%  Gaze Detection}{June 03--05, 2018}{Woodstock, NY}
% \acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
%  June 03--05, 2018, Woodstock, NY}
% \acmPrice{15.00}
% \acmISBN{978-1-4503-XXXX-X/18/06}

%%\acmSubmissionID{123-A56-BU3}

\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\rem}[2]{{\overline{#1}}^{#2}}
\newcommand{\X}{\boldsymbol{X}}
\newcommand{\Y}{\boldsymbol{Y}}
\newcommand{\Rseries}{\mathord{\R\llbracket\X\rrbracket}}
\DeclareMathOperator{\NonVan}{NV}
\DeclareMathOperator{\RF}{RF}
\newcommand{\Tower}{\mathord{\mathrm{Tower}}}
\newcommand{\smoothto}{\xrightarrow{C^\infty}}

% Syntax
\definecolor{ltblue}{rgb}{0,0.4,0.4}
\definecolor{dkblue}{rgb}{0,0.1,0.6}
\definecolor{dkgreen}{rgb}{0,0.35,0}
\definecolor{dkviolet}{rgb}{0.3,0,0.5}
\definecolor{dkred}{rgb}{0.5,0,0}
\definecolor{comment}{HTML}{444444}
\definecolor{keywd}{HTML}{8D00ED}
\definecolor{types}{HTML}{1F7B2F}
\definecolor{str}{HTML}{4070a0}
\definecolor{code-background}{gray}{0.8}
\definecolor{pragma}{HTML}{372A78}
\definecolor{num}{HTML}{40a070}
\definecolor{symb}{HTML}{000000}
\newcommand\symbmath[1]{{\ensuremath{\color{symb}#1}}}
\newcommand\typemath[1]{{\ensuremath{\ul{#1}}}}
\newcommand{\moncompose}{\mathbin{>\mkern-6mu=\mkern-6mu>}}
\newcommand\colmath[2]{{\ensuremath{\color{#1}#2}}}
\def\ul#1{{\underline{\smash{\bfseries #1}}}}
\newcommand{\divs}{\mathrel{\mid}}
\newcommand{\CartSp}{\mathord{\mathrm{CartSp}}}
\newcommand{\RAlg}{\mathord{\R{\text{-}}\mathrm{Alg}}}
\newcommand{\Sets}{\mathord{\mathrm{Sets}}}

\lstset{%
  basicstyle=\ttfamily,
  identifierstyle=,
  commentstyle={\color{comment}},
  keywordstyle={\ul\bfseries\color{keywd}},
  stringstyle={\slshape},
  stepnumber=1,
  % numbersep=-10pt,
  xleftmargin=15mm,framexleftmargin=15mm,
  rulecolor=\color{gray},
  frame=leftline,
  framerule=0.4pt,
  numberstyle=\tiny\ttfamily,
  numbers=left,
  stepnumber=1, 
  keywordstyle=,
  keywords={},
  emphstyle={},
  texcl=false,
  mathescape=false,
  literate={},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  breaklines=true,
  captionpos=t,
  rulecolor={\color{white}},
  columns=[c]fixed,
  keepspaces=true,
}
\lstdefinelanguage{algorithm}{
  morecomment=[l][\slshape\color{comment}]{//},
  morecomment=[n][\bfseries\itshape]{/*}{*/},
  morestring=[b]\",
  stringstyle={\slshape},
  keywords={Pick,For,Done,End,in,with,Let,While,Loop,Do,Then,Else,Until,Unless,Return,INPUT,OUTPUT,If},
  numbers=left,
  escapechar=\@,
  keywordstyle={\ul},
  morekeywords=[2]{*,+,/,-,.,\%,!,?,=,<,>,$},
  keywordstyle=[2]{\ttfamily\bfseries},
  morekeywords=[3]{Convol,WeilTest,LiftWeil,LiftSeriesPoly,TowerAD},
  keywordstyle=[3]{\rmfamily\upshape\scshape},
  emphstyle={[2]\itshape},
  literate=
    {/=}{{\symbmath{\neq}}}2
    {forall}{{\ensuremath{\pmb{\forall}}}}1
    {*}{{\symbmath{\times}}}1
    {I}{{\symbmath{I}}}1
    {+}{{\symbmath{+}}}1
    {>}{{\symbmath{>}}}2
    {...}{{\symbmath{\ldots}}}2
    {<}{{\symbmath{<}}}2
    {alpha}{{\symbmath{\alpha}}}1
    {beta}{{\symbmath{\beta}}}1
    {->}{{\symbmath{\rightarrow}}}2 {>=}{{\symbmath{\geq}}}2 {<-}{{\symbmath{\leftarrow}}}2
    {g_i}{{\symbmath{g_i}}}2
    {f_i}{{\symbmath{f_i}}}2
    {===}{{\symbmath{\equiv}}}2
    {==>}{{\symbmath{\Longrightarrow}}}{3}
    {\\}{{\symbmath{\lambda}}}1
    {<=}{{\symbmath{\leq}}}1 {=>}{{\symbmath{\Rightarrow}}}2
}
\lstnewenvironment{alg}[1][frame=leftline]{\lstset{language=algorithm}}{}

\lstdefinelanguage{Haskell}{
 morecomment=[l][\slshape\color{comment}]{--},
 morecomment=[n][\slshape\color{comment}]{\{-}{-\}},
 morecomment=[n][\bfseries\itshape]{\{-\#}{\#-\}},
 morestring=[b]\",
 stringstyle={\slshape},
 keywords={case,class,data,deriving,do,else,if,import,in,infixl,infixr,instance,let,infix,
	   module,of,primitive,then,type,where,family,newtype
 },
 numbers=left,
 stepnumber=1,
 keywordstyle={\bfseries},
 morekeywords=[2]{*,+,/,-,.,\%,!,?,=,<,>,$},
 keywordstyle=[2]{\ttfamily\bfseries},
 emph={[1] Bool,Char,Either,Float,IO,Int,Maybe,Ordering,Ratio,ReadS,ShowS,String,UVec,Vec,Functor,PowerSeries,%
	   InPacket,Sing,SNat,Show,Eq,KnownNat,Floating,Ord,Num,SingRep,Void,Monad,Field,Coeff,MyMat,DOrder,D1,%
           IsOrdPoly, CoeffRing, Ring, Abelian, Commutative, Group, Ideal, Unipol,Strategy,Just,Nothing,WeilSettings,%
           OrdPoly,IsMonomialOrder,MOrder,Coeff,Arity,Lex,Grevlex,Revlex,Homogenised,%
           Additive,Monoidal,OrderedMonomial,Module,LeftModule,Scalar,Type,Polynomial,Weil,%
           MMatrix,Matrix,Mutable,Vector,ST,Entry,HPS,%
           Unital,Multiplicative,HomogOrder%
 },
 emphstyle={[1]\ul},
 emph={[2] Powers,DiffFun,Mul,Add,K,EQ,False,GT,Just,LT,Left,Nothing,Right,True,Z,S,SS,SZ,sS,sZ
 },
 emphstyle={[2]\slshape},
 literate=
 {alpha}{{\symbmath{\alpha}}}1
 {beta}{{\symbmath{\beta}}}1
 {Integer}{{\typemath{\mathbb{Z}}}}2
   {Natural}{{\underline{\ensuremath{\mathbb{N}}}}}1
   {fromInteger}{{fromInteger}}{12}
   {Rational}{{\underline{\ensuremath{\mathbb{Q}}}}}1
   {Double}{{\underline{\ensuremath{\mathbb{R}}}}}1
   {::}{{\textcolor{symb}{:\!:}}}2
   {==}{{\symbmath{=}}}2
   {/=}{{\symbmath{\neq}}}2
   {forall}{{\ensuremath{\pmb{\forall}}}}1
   {*}{{\symbmath{\times}}}1
   {!*}{{\symbmath{\ltimes}}}2
   {+}{{\symbmath{+}}}1 {-}{{\symbmath{-}}}1
   {:-}{{:-}}2
   {eps}{{\symbmath{\varepsilon}}}1
   {eps1}{{\symbmath{\varepsilon_1}}}1
   {eps2}{{\symbmath{\varepsilon_2}}}1
   {Pi}{{\ensuremath{\boldsymbol{\Pi}}}}1
   {++}{{\symbmath{{}^{\frown}}}}2
   {\%-}{{\symbmath{\ominus}}}2
   {P.++}{{\symbmath{{}^{\frown}}}}2
   {>}{{\symbmath{>}}}2
   {<}{{\symbmath{<}}}2
   {\\}{{\symbmath{\lambda}}}1 {~}{{\symbmath{\sim}}}1
   {:~:}{{\symbmath{\simeq}}}2
   {Fp}{{\typemath{\mathbb{F}_p}}}2
   {\\\\}{{\color{symb}\char`\\\char`\\}}2 {phi}{{\ensuremath{\varphi}}}1
   {->}{{\symbmath{\rightarrow}}}2 {>=}{{\symbmath{\geq}}}2 {<-}{{\symbmath{\leftarrow}}}2
   {`elem`}{{\symbmath{\in}}}2 {kappa}{{\ensuremath{\kappa}}}1 {===}{{\symbmath{\equiv}}}2
   {`IsSubsetOf`}{{\symbmath{\subseteq}}}2
   {==>}{{\symbmath{\Longrightarrow}}}{3}
   {<=}{{\symbmath{\leq}}}1 {=>}{{\symbmath{\Rightarrow}}}2  {=~=}{{\symbmath{\cong}}}2
   {\ .}{{\symbmath{\circ}}}3 {\ .\ }{{\symbmath{\circ}}}3 {:=:}{{\symbmath{\approx}}}2
   {\ ..}{{{\color{symb}\ .\!\!.}}}2
   {\ ...}{{\ensuremath{\ .\hspace{-.1ex}.\hspace{-.1ex}.}}}2
   {\ .*}{{\ \symbmath{\bullet}}}{2}
   {\ .||.}{{\ \symbmath{\vee}}}3 {\ .&&.}{{\symbmath{\ \wedge}}}2
   {\ .=}{{\ \symbmath{{:}{=}}}}4
   {\ .\%=}{{\ \symbmath{{:}{\Leftarrow}}}}4
   {<\$>}{{\symbmath{{<}\!{\text{\textdollar}}\!{>}}}}3
   {<*>}{{\symbmath{{<}\!\!\!\ast\!\!\!{>}}}}3
   {>>}{{\symbmath{\gg}}}1 {>>=}{{\symbmath{\gg\mkern-6.5mu=}}}3
   {>>>}{{\symbmath{>\!>\!>}}}3
   {>=>}{{\symbmath{\moncompose}}}3
   {=<<}{{\symbmath{=\mkern-6.5mu\ll}}}3
   {|}{{\symbmath{\mid}}}1
   {FF}{{FF}}2
   {F\ }{{\typemath{\mathbb{F}\ }}}2
   {GF\ }{{\typemath{\mathbb{GF}\ }}}3
   {|*|}{{\symbmath{\otimes}}}1
}

\lstnewenvironment{code}[1][frame=leftline]{\lstset{language=Haskell, #1}}{}

\newcommand{\hask}[1]{\lstinline[backgroundcolor=\color{gray},language=haskell]{#1}}
